 <div> <div class="flex justify-start">
    <!-- Alert interactif -->
  <app-alert
    *ngIf="alert.show"
    [variant]="alert.variant"
    [title]="alert.title"
    [message]="alert.message"
  >
    <div class="mt-3 flex justify-end gap-2" *ngIf="alert.variant === 'warning'">
      <button
        (click)="confirmDelete()"
        class="px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700"
      >
        Confirmer
      </button>
      <button
        (click)="cancelDelete()"
        class="px-3 py-1 bg-gray-300 text-gray-800 rounded hover:bg-gray-400"
      >
        Annuler
      </button>
    </div>
  </app-alert>
 </div>
 <div class="flex justify-end">
  
    <button 
      routerLink="/tickets/new"
      class="inline-flex items-center gap-2 rounded-lg bg-brand-500 px-4 py-3 text-theme-sm font-medium text-white shadow-theme-xs hover:bg-brand-600"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
      </svg>
      Nouvel ticket
    </button>
  </div>
</div>

  <br>
  <div class="rounded-2xl border border-gray-200 bg-white pt-4 dark:border-white/[0.05] dark:bg-white/[0.03]">
  <!-- Loading indicator -->
  <div *ngIf="loading" class="flex justify-center items-center py-12">
    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-brand-500"></div>
  </div>
  

  <!-- Header -->
  <div class="flex justify-between px-6 mb-4">
    <h3 class="text-lg font-semibold text-gray-800 dark:text-white/90">
      Liste des Tickets
        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">
      {{ totalCount }} ticket(s) trouvé(s)
    </p>
    </h3>

    <!--<input
      type="text"
      [(ngModel)]="searchTerm"
      (input)="search()"
      placeholder="Rechercher..."
      class="h-[40px] rounded-lg border border-gray-300 px-4 text-sm focus:border-brand-300 focus:outline-none"
    />-->

</div>

<!-- Barre d'actions avec bouton Filtrer et Nouvel incident -->
<div class="flex flex-col gap-4 px-6 mb-4 sm:flex-row sm:items-center sm:justify-between">

  <!-- Bouton Filtrer à gauche -->
  <div class="flex items-center gap-3">
    <button
      (click)="toggleFilters()"
      class="inline-flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-3 text-sm font-medium text-gray-700 shadow-theme-xs hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03]"
      [class.bg-brand-50]="showFilters"
      [class.text-brand-600]="showFilters"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
      </svg>
      Filtrer
      <span *ngIf="selectedPriorite !== undefined || selectedStatut !== undefined || selectedYear" 
            class="ml-1 inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-brand-500 rounded-full">
        {{ (selectedPriorite !== undefined ? 1 : 0) + (selectedStatut !== undefined ? 1 : 0) + (selectedDate ? 1 : 0) }}
      </span>
    </button>

    <!-- Indicateur de filtres actifs -->
    <div *ngIf="selectedPriorite !== undefined || selectedStatut !== undefined || selectedYear" class="text-sm text-gray-500">
      <span>Filtres actifs</span>
      <button (click)="clearFilters()" class="ml-2 text-brand-500 hover:text-brand-600">
        <svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
  </div>

  <!-- Barre de recherche -->
  <div class="relative">
      <span class="absolute -translate-y-1/2 pointer-events-none left-4 top-1/2">
      <svg class="fill-gray-500 dark:fill-gray-400" width="20" height="20" viewBox="0 0 20 20" fill="none">
        <path fill-rule="evenodd" clip-rule="evenodd"
          d="M3.04175 9.37363C3.04175 5.87693 5.87711 3.04199 9.37508 3.04199C12.8731 3.04199 15.7084 5.87693 15.7084 9.37363C15.7084 12.8703 12.8731 15.7053 9.37508 15.7053C5.87711 15.7053 3.04175 12.8703 3.04175 9.37363ZM9.37508 1.54199C5.04902 1.54199 1.54175 5.04817 1.54175 9.37363C1.54175 13.6991 5.04902 17.2053 9.37508 17.2053C11.2674 17.2053 13.003 16.5344 14.357 15.4176L17.177 18.238C17.4699 18.5309 17.9448 18.5309 18.2377 18.238C18.5306 17.9451 18.5306 17.4703 18.2377 17.1774L15.418 14.3573C16.5365 13.0033 17.2084 11.2669 17.2084 9.37363C17.2084 5.04817 13.7011 1.54199 9.37508 1.54199Z"
          fill="" />
      </svg>
    </span>
    <input
      type="text"
      [(ngModel)]="searchTerm"
      (input)="onSearch()"
      placeholder="Rechercher ticket..."
      class="dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-200 bg-transparent py-2.5 pl-12 pr-14 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-800 dark:bg-gray-900 dark:bg-white/[0.03] dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800 xl:w-[430px]"
    />
  </div>

</div>

<!-- Filtres déroulants -->
<div *ngIf="showFilters" class="mx-6 mb-6 p-6 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700">
  <h4 class="text-md font-semibold text-gray-700 dark:text-gray-300 mb-4">Filtres avancés</h4>
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <div>
      <label class="block text-sm font-medium text-gray-700 dark:text-gray-400 mb-2">Priorité</label>
      <select [(ngModel)]="tempFilters.priorite" class="w-full h-11 px-4 text-sm rounded-lg border border-gray-300 dark:border-gray-700 dark:bg-gray-800">
        <option [ngValue]="undefined">Toutes priorités</option>
        <option [ngValue]="1">Basse</option>
        <option [ngValue]="2">Normale</option>
        <option [ngValue]="3">Haute</option>
      </select>
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700 dark:text-gray-400 mb-2">Statut</label>
      <select [(ngModel)]="tempFilters.statut" class="w-full h-11 px-4 text-sm rounded-lg border border-gray-300 dark:border-gray-700 dark:bg-gray-800">
        <option [ngValue]="undefined">Tous statuts</option>
        <option [ngValue]="1">Nouveau</option>
        <option [ngValue]="2">Assigné</option>
        <option [ngValue]="3">En cours</option>
        <option [ngValue]="4">En Attente</option>
        <option [ngValue]="5">Résolu</option>
        <option [ngValue]="6">Clôturé</option>
        <option [ngValue]="7">Réouvert</option>
      </select>
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700 dark:text-gray-400 mb-2">Année de création</label>
     <app-date-picker
  [value]="selectedDate"
  placeholder="JJ/MM/AAAA"
  (dateChange)="onTicketDateChange($event)"
  [maxDate]="maxTicketDate"
/>
    </div>
  </div>

  <!-- Actions -->
  <div class="flex justify-end gap-3 mt-6">
    <button (click)="cancelFilters()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-700 dark:hover:bg-gray-700">Annuler</button>
    <button (click)="clearFilters()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-700 dark:hover:bg-gray-700">Effacer tout</button>
    <button (click)="applyFilters()" class="px-4 py-2 text-sm font-medium text-white bg-brand-500 rounded-lg hover:bg-brand-600">Appliquer les filtres</button>
  </div>
</div>
  <!-- Table -->
  <div class="overflow-x-auto px-6">
    <table class="min-w-full">
      <thead class="border-y border-gray-100">
        <tr>
          <th class="py-3 text-start text-sm text-gray-500">Référence</th>
          <th class="px-4 py-3 text-start text-sm text-gray-500">Titre</th>
          <th class="px-4 py-3 text-start text-sm text-gray-500">Créateur</th>
          <th class="px-4 py-3 text-start text-sm text-gray-500">Priorité</th>
          <th class="px-4 py-3 text-start text-sm text-gray-500">Statut</th>
          <th class="px-4 py-3 text-start text-sm text-gray-500">Date Création</th>
          <th class="px-4 py-3 text-start text-sm text-gray-500">             Action
</th>
        </tr>
      </thead>

      <tbody class="divide-y divide-gray-100">
        @for (ticket of tickets; track $index) {
        <tr>

          <td class="px-4 py-4 font-medium text-gray-700">
            {{ ticket.referenceTicket }}
          </td>

          <td class="px-4 py-4">
            {{ ticket.titreTicket }}
          </td>

          <td class="px-4 py-4">
            <div class="flex items-center gap-3">
              <app-avatar-text 
                [name]="ticket.createurNom || 'N/A'" 
                class="w-8 h-8"
              />
              <div>
                <span class="block text-theme-sm font-medium text-gray-700 dark:text-gray-400">
                  {{ ticket.createurNom || 'Non assigné' }}
                </span>
              </div>
            </div>
          </td>

          <td class="px-4 py-4">
     <app-badge 
  size="sm"  
  [color]="getPriorityBadgeColor(ticket.prioriteTicketLibelle)">
  {{ ticket.prioriteTicketLibelle }}
</app-badge>
          </td>

          <td class="px-4 py-4">
       <app-badge
  size="sm"
  [color]="getStatusBadgeColor(ticket.statutTicketLibelle)">
  {{ ticket.statutTicketLibelle }}
</app-badge>
          </td>

          <td class="px-4 py-4">
            {{ ticket.dateCreation | date:'dd/MM/yyyy HH:mm' }}
          </td>

            <td class="px-4 py-4 text-gray-700 text-theme-sm dark:text-gray-400">
              <div class="relative inline-block">
                <app-table-dropdown>
                  <div dropdown-button>
                    <button class="text-gray-500 dark:text-gray-400">
                      <svg
                        class="fill-current"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          fill-rule="evenodd"
                          clip-rule="evenodd"
                          d="M5.99902 10.245C6.96552 10.245 7.74902 11.0285 7.74902 11.995V12.005C7.74902 12.9715 6.96552 13.755 5.99902 13.755C5.03253 13.755 4.24902 12.9715 4.24902 12.005V11.995C4.24902 11.0285 5.03253 10.245 5.99902 10.245ZM17.999 10.245C18.9655 10.245 19.749 11.0285 19.749 11.995V12.005C19.749 12.9715 18.9655 13.755 17.999 13.755C17.0325 13.755 16.249 12.9715 16.249 12.005V11.995C16.249 11.0285 17.0325 10.245 17.999 10.245ZM13.749 11.995C13.749 11.0285 12.9655 10.245 11.999 10.245C11.0325 10.245 10.249 11.0285 10.249 11.995V12.005C10.249 12.9715 11.0325 13.755 11.999 13.755C12.9655 13.755 13.749 12.9715 13.749 12.005V11.995Z"
                          fill=""
                        />
                      </svg>
                    </button>
                  </div>
                  <div dropdown-content>
                    <button
  [routerLink]="['/tickets', ticket.id]"

                      class="text-xs flex w-full rounded-lg px-3 py-2 text-left font-medium text-gray-500 hover:bg-gray-100 hover:text-gray-700 dark:text-gray-400 dark:hover:bg-white/5 dark:hover:text-gray-300"
                    >
Details                    </button>
  <button
    [routerLink]="['/tickets/edit', ticket.id]"

                      class="text-xs flex w-full rounded-lg px-3 py-2 text-left font-medium text-gray-500 hover:bg-gray-100 hover:text-gray-700 dark:text-gray-400 dark:hover:bg-white/5 dark:hover:text-gray-300"
                    >
                      Edit
                    </button>
                    <button
(click)="deleteTicket(ticket)"
                      class="text-xs flex w-full rounded-lg px-3 py-2 text-left font-medium text-gray-500 hover:bg-gray-100 hover:text-gray-700 dark:text-gray-400 dark:hover:bg-white/5 dark:hover:text-gray-300"
                    >
                      Delete
                    </button>
                  </div>
                </app-table-dropdown>
              </div>
            </td>

        </tr>
        }
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
 <div class="px-6 py-4 border-t border-gray-200 dark:border-white/[0.05]" *ngIf="!loading && !error && filteredTickets.length > 0">
    <div class="flex items-center justify-between">
      <!-- Previous Button -->
      <app-button
        size="sm"
        variant="outline"
        (btnClick)="onPageChange(currentPage - 1)"
        [disabled]="currentPage === 1 || totalPages === 0"
      >
        <svg class="fill-current" width="20" height="20" viewBox="0 0 20 20">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M12.7071 5.29289C13.0976 5.68342 13.0976 6.31658 12.7071 6.70711L9.41421 10L12.7071 13.2929C13.0976 13.6834 13.0976 14.3166 12.7071 14.7071C12.3166 15.0976 11.6834 15.0976 11.2929 14.7071L7.29289 10.7071C6.90237 10.3166 6.90237 9.68342 7.29289 9.29289L11.2929 5.29289C11.6834 4.90237 12.3166 4.90237 12.7071 5.29289Z"
            fill="" />
        </svg>
        <span class="hidden sm:inline">Précédent</span>
      </app-button>
      
      <!-- Page Info (Mobile) -->
      <span class="block text-sm font-medium text-gray-700 dark:text-gray-400 sm:hidden">
        Page {{ currentPage }} / {{ totalPages || 1 }}
      </span>
      
      <!-- Page Numbers (Desktop) -->
      <ul class="hidden items-center gap-0.5 sm:flex">
        <ng-container *ngIf="totalPages > 0; else noPages">
          <li *ngFor="let page of getPageNumbers()">
            <ng-container *ngIf="page !== -1; else ellipsis">
              <button
                (click)="onPageChange(page)"
                class="flex h-10 w-10 items-center justify-center rounded-lg text-theme-sm font-medium"
                [ngClass]="{
                  'bg-brand-500 text-white': currentPage === page,
                  'text-gray-700 hover:bg-brand-500/[0.08] dark:text-gray-400': currentPage !== page
                }"
              >
                {{ page }}
              </button>
            </ng-container>
            <ng-template #ellipsis>
              <span class="flex h-10 w-10 items-center justify-center text-gray-500">...</span>
            </ng-template>
          </li>
        </ng-container>
        <ng-template #noPages>
          <li>
            <button class="flex h-10 w-10 items-center justify-center rounded-lg bg-brand-500 text-white">
              1
            </button>
          </li>
        </ng-template>
      </ul>
      
      <!-- Next Button -->
      <app-button
        (btnClick)="onPageChange(currentPage + 1)"
        size="sm"
        variant="outline"
        [disabled]="currentPage === totalPages || totalPages === 0"
      >
        <span class="hidden sm:inline">Suivant</span>
        <svg class="fill-current" width="20" height="20" viewBox="0 0 20 20">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M7.29289 14.7071C6.90237 14.3166 6.90237 13.6834 7.29289 13.2929L10.5858 10L7.29289 6.70711C6.90237 6.31658 6.90237 5.68342 7.29289 5.29289C7.68342 4.90237 8.31658 4.90237 8.70711 5.29289L12.7071 9.29289C13.0976 9.68342 13.0976 10.3166 12.7071 10.7071L8.70711 14.7071C8.31658 15.0976 7.68342 15.0976 7.29289 14.7071Z"
            fill="" />
        </svg>
      </app-button>
    </div>
  </div>

</div>

