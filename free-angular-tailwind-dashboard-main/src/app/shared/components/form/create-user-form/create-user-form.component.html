<app-component-card title="CrÃ©er un nouvel utilisateur">
  <div class="space-y-8">
    
    <app-alert
      *ngIf="alert.show"
      [variant]="alert.variant"
      [title]="alert.title"
      [message]="alert.message"
      (click)="alert.show = false"
    ></app-alert>

    <form (ngSubmit)="onSubmit()" [formGroup]="userForm" class="space-y-6">
      
      <!-- Section 1 : Informations personnelles -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- PrÃ©nom -->
        <div>
          <app-label for="prenom">PrÃ©nom <span class="text-error-500">*</span></app-label>
          <app-input-field
            type="text"
            id="prenom"
            placeholder="Jean"
            [value]="userForm.get('prenom')?.value"
            (valueChange)="userForm.get('prenom')?.setValue($event)"
          />
          <div *ngIf="userForm.get('prenom')?.touched && userForm.get('prenom')?.invalid" 
               class="text-error-500 text-sm mt-1">
            Le prÃ©nom est requis (min. 2 caractÃ¨res)
          </div>
        </div>

        <!-- Nom -->
        <div>
          <app-label for="nom">Nom <span class="text-error-500">*</span></app-label>
          <app-input-field
            type="text"
            id="nom"
            placeholder="Dupont"
            [value]="userForm.get('nom')?.value"
            (valueChange)="userForm.get('nom')?.setValue($event)"
          />
          <div *ngIf="userForm.get('nom')?.touched && userForm.get('nom')?.invalid" 
               class="text-error-500 text-sm mt-1">
            Le nom est requis (min. 2 caractÃ¨res)
          </div>
        </div>
      </div>

      <!-- Section 2 : Contact -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Email -->
        <div>
          <app-label for="email">Email <span class="text-error-500">*</span></app-label>
          <app-input-field
            type="email"
            id="email"
            placeholder="jean.dupont@example.com"
            [value]="userForm.get('email')?.value"
            (valueChange)="userForm.get('email')?.setValue($event)"
          />
          <div *ngIf="userForm.get('email')?.touched && userForm.get('email')?.invalid" 
               class="text-error-500 text-sm mt-1">
            Email invalide
          </div>
        </div>

        <!-- TÃ©lÃ©phone -->
  <div>
  <app-label for="phoneNumber">
    TÃ©lÃ©phone <span class="text-error-500">*</span>
  </app-label>

  <app-input-field
    type="tel"
    id="phoneNumber"
    placeholder="+33 1 23 45 67 89"
    [value]="phoneNumber?.value"
    (valueChange)="phoneNumber?.setValue($event)"
  />

  @if (phoneNumber?.invalid && (phoneNumber?.dirty || phoneNumber?.touched)) {
    <p class="mt-1 text-sm text-red-500">
      @if (phoneNumber?.errors?.['required']) {Phone number is required}
      @if (phoneNumber?.errors?.['pattern']) {Invalid phone number}
    </p>
  }
</div>

      </div>


      <!-- Section 3 : RÃ´le et Date de naissance -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- RÃ´le -->
        <div>
          <app-label for="role">RÃ´le <span class="text-error-500">*</span></app-label>
          <app-select
              [options]="roleOptions"
            placeholder="SÃ©lectionner un rÃ´le"
            [value]="userForm.get('roleId')?.value"
            (valueChange)="userForm.get('roleId')?.setValue($event)"
            className="dark:bg-dark-900"
          ></app-select>
         
 
          <div *ngIf="userForm.get('roleId')?.touched && userForm.get('roleId')?.invalid" 
               class="text-error-500 text-sm mt-1">
            Le rÃ´le est requis
          </div>
        </div>

        <!-- Date de naissance -->
        <div>
          <app-label for="birthDate">Date de naissance<span class="text-error-500">*</span></app-label>
          <app-date-picker
  id="birthDate"
  placeholder="JJ/MM/AAAA"
  (dateChange)="userForm.get('birthDate')?.setValue($event)"
/>
@if (birthDate?.touched && birthDate?.errors?.['underAge']) {
  <p class="mt-1 text-sm text-red-500">
    Vous devez avoir au moins 18 ans
  </p>
}

        </div>
      </div>

      <!-- Section 4 : Image -->
      <div>
        <app-label>Photo de profil</app-label>
        <app-file-input-example
      (change)="onImageSelected($event)"
        ></app-file-input-example>
        
        <!-- PrÃ©visualisation -->
        <div *ngIf="imagePreview" class="mt-4">
          <p class="text-sm text-gray-600 mb-2">PrÃ©visualisation :</p>
          <img [src]="imagePreview" alt="Preview" class="w-24 h-24 rounded-full object-cover border">
        </div>
      </div>

      <!-- Section 5 : Mot de passe -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Mot de passe -->
        <div>
          <app-label for="password">Mot de passe <span class="text-error-500">*</span></app-label>
          <div class="relative">
            <app-input-field
              id="password"
              [type]="showPassword ? 'text' : 'password'"
              placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
              [value]="userForm.get('password')?.value"
              (valueChange)="userForm.get('password')?.setValue($event)"
            />
            <button
              type="button"
              (click)="togglePasswordVisibility('password')"
              class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500"
            >
              {{ showPassword ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
            </button>
          </div>
          <div *ngIf="userForm.get('password')?.touched && userForm.get('password')?.invalid" 
               class="text-error-500 text-sm mt-1">
            Minimum 8 caractÃ¨res
          </div>
        </div>

        <!-- Confirmation mot de passe -->
        <div>
          <app-label for="confirmPassword">Confirmer le mot de passe <span class="text-error-500">*</span></app-label>
          <div class="relative">
            <app-input-field
              id="confirmPassword"
              [type]="showConfirmPassword ? 'text' : 'password'"
              placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
              [value]="userForm.get('confirmPassword')?.value"
              (valueChange)="userForm.get('confirmPassword')?.setValue($event)"
            />
            <button
              type="button"
              (click)="togglePasswordVisibility('confirmPassword')"
              class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500"
            >
              {{ showConfirmPassword ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
            </button>
          </div>
          <div *ngIf="userForm.get('confirmPassword')?.touched && 
                      (userForm.get('confirmPassword')?.invalid || userForm.hasError('mismatch'))" 
               class="text-error-500 text-sm mt-1">
            Les mots de passe ne correspondent pas
          </div>
        </div>
      </div>

      <!-- Boutons -->
      <div class="flex justify-end space-x-4 pt-6 border-t dark:border-gray-700">
        <app-button
          type="button"
          variant="outline"
          (btnClick)="cancel()"
        >
          Annuler
        </app-button>
        <app-button
          type="submit"
          variant="primary"
          [disabled]="userForm.invalid || loading"
          (btnClick)="onSubmit()"  

        >
          {{ loading ? 'CrÃ©ation en cours...' : 'CrÃ©er l\'utilisateur' }}
        </app-button>
      </div>
    </form>
  </div>
</app-component-card>